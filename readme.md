# Bacon Challenge

This repo provides a tool for calculating the degrees of separation between any two actors, inspired by [Bacon Numbers](https://en.wikipedia.org/wiki/Six_Degrees_of_Kevin_Bacon#Bacon_numbers), based on the [Movie Dataset](https://www.kaggle.com/rounakbanik/the-movies-dataset). It also provides a very basic HTTP API for fetching degrees of separation, as well as adding new movies to the data.

## Prerequisites

All of the code is in Python 3, written and tested with 3.9.1. The following non-standard Python libraries are required for various pieces of this repo, all of which can be installed via "pip install \<lib\>" assuming a standard Python install:

* flask
* pytest
* requests
* sortedcontainers

## Summary

Once the prerequisites are met, the various scripts and their purposes are:

* parse_movies.py - provides functions for parsing the dataset into a form useable by query_degrees.py (only credits.csv from the Movies Database is currently supported)
* query_degrees.py - provides methods for processing the graphs generated by parse_movies.py
* server.py - an extremely basic HTTP server which hosts an API that uses the above tools to calculate and return actor degrees of separation
* client.py - an extremely basic script which accepts root and target actors via user or file input and queries the server for results
* test_*.py - tests, intended to be run via pytest (warning: can be slow)

## Usage

The typical usage, from scratch, is:

1. Download the [Movie Dataset](https://www.kaggle.com/rounakbanik/the-movies-dataset). Once extracted, you'll need the credits.csv file for the next step.

2. Preprocess credits.csv by running (modify paths as necessary):

```
python -m graph.parse_movies credits.csv
```

This will output an actors.jsonl file which will be consumed later. It should take less than a minute, and prints progress updates.

3. Run the server:

```
python -m http_api.server
```

This will take ~10-15 seconds to start up while it builds a graph from the preprocessed data - an unfortunate startup time, but the server is long-lived and an easy improvement would be to persist the graphs to another file.

Note that your terminal/prompt/etc. will block while the server runs using the above command, so you'll need a separate one for the client.

4. Run the client:

```
python -m http_api.client

or

python -m http_api.client -f http_api/client_example.data
```

Without an input file, the client will repeatedly prompt the user for two actors to determine the degree of separation between. It will ask the server and print the response.

With an input file, the client will send all requests defined in the file and then return without waiting for input. See client_example.data for the structure of the data and an example request of each type. Requests which add new movies/actors will be persisted across server runs.

5. Run the tests (they also expect preprocessing to be done):

```
pytest.exe
```

pytest may not be directly accessible by default, depending on your install settings. The tests include some slow/degenerate cases in addition to constructing the entire graph, and can take up to a minute to run as a result. This should definitely be improved in the future.

In addition to the output of pytest, a results file will be generated in a test_results folder. This is a csv showing how long it took to determine the degree of separation of each pair of actors in the tests.

## Improvements

Here's a non-exhaustive list of improvements that could be made.

* Nothing is optimized for any particular actor, despite the challenge being about Kevin Bacon. In most cases (degree <= 3) this is okay, but you could easily build trees rather than connected graphs with a given actor at the root which should be much faster to query due to having far fewer connections (each actor would only connect to actors who are at depth n - 1 or n + 1 relative to the root - that means they're not connected to *each other* at any given layer, either). You could provide specific APIs for each of these trees, much like there's a Kevin Bacon-specific API currently.
* As mentioned above, persisting the graphs to files would significantly speed up initialization, at the cost of a little more preprocessing. This is a very good and easy optimization that I am skipping solely for the sake of time, but is obviously doable based on the rest of the code so far.
* All comparisons are case-sensitive. You should be able to search for "kevin bacon", or "kEvIn BaCoN", if that's your fancy. Simple solution is to lower-case everything, but you'd quickly run into issues with foreign names doing it naively.
* No input is validated. This is mentioned in a couple of comments, but neither the data nor user input are sanitized. This would not be appropriate in production.
* The poor cases - degree 4+ - can take an egregiously long time and provide no feedback. This relates to the first bullet point (optimize for individual actors), but it's also about usability. There will always be pathological cases, and we shouldn't just stall without notifying the user for several seconds (let alone 20+).
* No metadata. We can fetch degrees of separation, but a user might care about some of the 'trivia' surrounding connections:
  * which movies and actors connect two actors
  * given the above, the ability to see alternate connection paths
  * ask how two actors are connected through a third one - e.g. Kevin Bacon and Billy Boyd have a degree of 2, but is there a chain - perhaps of greater degree - that links them via George Clooney or Humphrey Bogart in particular?
